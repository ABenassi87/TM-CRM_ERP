{"tabs":[{"id":"1498552695920","name":"Prices","icon":"fa-object-ungroup","linker":"prices","index":0},{"name":"Orders","linker":"orders","id":"1498565673952","index":1}],"components":[{"component":"redissubscribe","state":{"text":"","color":"gray"},"x":59,"y":266,"tab":"1498552695920","connections":{"0":["1498563752381"]},"id":"1498562933261","options":{"channel":"product:*"},"name":"product","reference":""},{"component":"debug","state":{"text":"Enabled","color":"gray"},"x":637,"y":133,"tab":"1498552695920","connections":{},"id":"1498563181178","options":{"enabled":true,"property":""},"name":""},{"component":"switch","state":{"text":"Last: product:update","color":"gray"},"x":189,"y":170,"tab":"1498552695920","connections":{"0":["1498567611400"],"1":["1498565569369"]},"id":"1498563752381","options":{"conditions":[{"operator":"==","datatype":"String","value":"product:updateDirectCost","index":0},{"operator":"==","datatype":"String","value":"product:update","index":1}],"property":"channel"},"name":"channel routing","reference":"","output":2},{"component":"debug","state":{"text":"Disabled","color":"gray"},"x":637,"y":310,"tab":"1498552695920","connections":{},"id":"1498563854903","options":{"enabled":false},"name":""},{"component":"condition","state":{"text":"","color":"gray"},"x":414,"y":340,"tab":"1498552695920","connections":{"0":["1498563854903"]},"id":"1498565569369","options":{"output":1,"condition":"// Next has to contain an index for output (null/undefiend) will cancel current data\n\nnext(value.data.product && value.data.product._id ? 0 : null)"},"name":"isProduct","output":1,"reference":"update"},{"component":"condition","state":{"text":"","color":"gray"},"x":373,"y":56,"tab":"1498552695920","connections":{"0":["1498573052034"]},"id":"1498567611400","options":{"output":1,"condition":"// Next has to contain an index for output (null/undefiend) will cancel current data\n\nnext(value.data.product && value.data.product._id ? 0 : null)"},"name":"isProduct","output":1,"reference":"updateDirectCost"},{"component":"functiontm","state":{"text":"","color":"gray"},"x":442,"y":166,"tab":"1498552695920","connections":{"0":["1498563181178"]},"id":"1498573052034","options":{"outputs":1,"code":"function(data, callback) {\n    var ProductModel = MODEL('product').Schema;\n    \n    ProductModel.find({ 'bundles.id': data.product._id })\n                        //.populate({ path: 'product', select: 'sellFamily', populate: { path: \"sellFamily\" } })\n                        //.populate(\"priceLists\")\n                        .populate(\"pack.id\", \"info directCost indirectCost\")\n                        .populate(\"bundles.id\", \"info directCost indirectCost\")\n                        .populate({\n                            path: 'info.productType'\n                                //    populate: { path: \"options\" }\n                        })\n                        .populate({\n                            path: 'sellFamily',\n                            populate: { path: \"options\", populate: { path: \"group\" } }\n                        })\n                        .exec(function(err, products) {\n                            products.forEach(function(product) {\n                                if (!product.isBundle)\n                                    return;\n\n                                product.save(function(err, doc) {\n                                    if (err)\n                                        return callback(err);\n\n                                    //F.functions.PubSub.emit('product:updateDirectCost', {\n                                    //    data: doc\n                                    //});\n                                });\n                            });\n        \tcallback(null,\"Ca marche !\");\n                        });\n   \n\tconsole.log(\"toto\", data);\n};","output":1},"name":"Test"}]}